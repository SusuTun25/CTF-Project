import React, { useState, useEffect } from 'react';
import { Card, Nav, Alert } from 'react-bootstrap';
import ChallengeInterface from '../components/ChallengeInterface';
import challengeData from '../challengeData';

const WebExploitationChallenge1 = () => {
  const [currentPage, setCurrentPage] = useState('home');
  const [userId, setUserId] = useState('1');
  const challenge = challengeData.webExploitation.find(c => c.id === 'web1');

  useEffect(() => {
    // Expose the setUserId function to the global scope
    window.changeUserId = (newId) => {
      setUserId(newId);
      console.log(`User ID changed to: ${newId}`);
    };

    // Cleanup
    return () => {
      delete window.changeUserId;
    };
  }, []);

  const handlePageChange = (page) => {
    setCurrentPage(page);
  };

  const getPageContent = () => {
    switch(currentPage) {
      case 'home':
        return (
          <Alert variant="info">
            <Alert.Heading>Welcome</Alert.Heading>
            <p>Welcome to The Phantom Collective's User Portal. Navigate to your profile to view your information.</p>
          </Alert>
        );
      case 'profile':
        if (userId === 'adm1n') {
          return (
            <Alert variant="success">
              <Alert.Heading>Admin Panel</Alert.Heading>
              <p>Congratulations! You've found the admin panel.</p>
              <p>The flag is: 'IDOR_L34DS_T0_PR1V_3SC'</p>
            </Alert>
          );
        } else {
          return (
            <Alert variant="info">
              <Alert.Heading>User Profile</Alert.Heading>
              <p>User ID: {userId}</p>
              <p>This is a regular user profile. Nothing interesting here.</p>
            </Alert>
          );
        }
      default:
        return <p>Page not found</p>;
    }
  };

  const challengeContent = (
    <Card className="mt-4">
      <Card.Body>
        <Card.Title className="text-center mb-4">The Phantom's Control Panel</Card.Title>
        <Nav variant="tabs" className="mb-3">
          <Nav.Item>
            <Nav.Link onClick={() => handlePageChange('home')}>Home</Nav.Link>
          </Nav.Item>
          <Nav.Item>
            <Nav.Link onClick={() => handlePageChange('profile')}>Profile</Nav.Link>
          </Nav.Item>
        </Nav>
        {getPageContent()}
      </Card.Body>
    </Card>
  );

  return (
    <ChallengeInterface challenge={challenge}>
      {challengeContent}
    </ChallengeInterface>
  );
};

export default WebExploitationChallenge1;